name: 'rush publish'
inputs:
  authorName:
    required: true
  authorEmail:
    required: true
  npmUsername:
    required: true
  npmPassword:
    required: true
  targetBranch:
    required: false
    default: main
runs:
  using: "composite"
  steps:
    - name: Setup git user
      run: |
        git config --local user.name "${{ inputs.authorName }}"
        git config --local user.email "${{ inputs.authorEmail }}"
      shell: bash
    - name: Set npm auth
      run: |
        curl -u ${{ inputs.npmUsername }}:${{ inputs.npmPassword }} https://jfrog.teliacompany.io/artifactory/api/npm/auth > ~/.npmrc
      shell: bash
    - name: Publish
      run: |
        node common/scripts/install-run-rush.js publish --publish --include-all
      shell: bash
      env:
        NPM_ALWAYS_AUTH: true
        NPM_CONFIG_REGISTRY: https://jfrog.teliacompany.io/artifactory/api/npm/dcse-npm/
        NPM_CONFIG_NOPROXY: jfrog.teliacompany.io
